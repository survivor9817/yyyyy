<!DOCTYPE html>
<html lang="fa">
  <head>
    <meta charset="UTF-8" />
    <title>ุงุฑุฌุงุน ูุชู</title>
    <style>
      body {
        font-family: sans-serif;
        direction: rtl;
        padding: 20px;
      }
      .container {
        display: flex;
        gap: 20px;
      }
      .text-box {
        border: 1px solid #999;
        padding: 10px;
        width: 45%;
        height: 200px;
        overflow-y: auto;
        background: #fefefe;
      }
      .label {
        font-weight: bold;
        margin-bottom: 5px;
      }
      button {
        margin-top: 10px;
      }
      .highlight {
        background-color: yellow;
      }
    </style>
  </head>
  <body>
    <div class="label">๐จ ูุชู ูุฑุฌุน (ููุจุน ุงุฑุฌุงุน):</div>
    <div id="sourceText" class="text-box" contenteditable="true">
      ุงู ูุชู ูุฑุจูุท ุจู ููุจุน ุงุฑุฌุงุน ุงุณุช. ุดูุง ูโุชูุงูุฏ ุจุฎุด ุงุฒ ุงู ูุชู ุฑุง ุจุนุฏ ุงุฒ
      ุงูุชุฎุงุจ ูุชู ููุตุฏ ุงูุชุฎุงุจ ฺฉูุฏ.
    </div>

    <div class="label">๐ฆ ูุชู ููุตุฏ (ูุญู ูุงุฒ ุจู ุงุฑุฌุงุน):</div>
    <div id="targetText" class="text-box" contenteditable="true">
      ุงู ูุชู ูุฑุจูุท ุจู ููุตุฏ ุงุฑุฌุงุน ุงุณุช. ุงุจุชุฏุง ุจุฎุด ุงุฒ ุงู ูุชู ุฑุง ุงูุชุฎุงุจ ฺฉุฑุฏู ู
      ุณูพุณ ุฏฺฉูู "ุงุฑุฌุงุน" ุฑุง ุจุฒูุฏ.
    </div>

    <button id="startReferenceBtn">ุงุฑุฌุงุน</button>
    <button id="saveReferenceBtn" disabled>ุซุจุช ุงุฑุฌุงุน</button>

    <script>
      let targetSelection = "";
      let sourceSelection = "";

      const targetBox = document.getElementById("targetText");
      const sourceBox = document.getElementById("sourceText");
      const startBtn = document.getElementById("startReferenceBtn");
      const saveBtn = document.getElementById("saveReferenceBtn");

      function getSelectedTextInElement(el) {
        const selection = window.getSelection();
        if (!selection.rangeCount || selection.isCollapsed) return "";
        const range = selection.getRangeAt(0);
        const container = range.commonAncestorContainer;
        return el.contains(container) ? selection.toString() : "";
      }

      startBtn.addEventListener("click", () => {
        targetSelection = getSelectedTextInElement(targetBox);
        if (!targetSelection) {
          alert("ูุทูุงู ุงุจุชุฏุง ุนุจุงุฑุช ุฑุง ุฏุฑ ูุชู ููุตุฏ ุงูุชุฎุงุจ ฺฉูุฏ.");
          return;
        }
        alert(
          'ุนุจุงุฑุช ููุตุฏ ุซุจุช ุดุฏ. ุญุงูุง ุงุฒ ูุชู ูุฑุฌุน ุงูุชุฎุงุจ ฺฉูุฏ ู ุณูพุณ ุฑู "ุซุจุช ุงุฑุฌุงุน" ฺฉูฺฉ ฺฉูุฏ.'
        );
        saveBtn.disabled = false;
      });

      saveBtn.addEventListener("click", () => {
        sourceSelection = getSelectedTextInElement(sourceBox);
        if (!sourceSelection) {
          alert("ูุทูุงู ุนุจุงุฑุช ุฑุง ุฏุฑ ูุชู ูุฑุฌุน ุงูุชุฎุงุจ ฺฉูุฏ.");
          return;
        }

        console.log("โ ุงุฑุฌุงุน ุซุจุช ุดุฏ:");
        console.log("ููุตุฏ:", targetSelection);
        console.log("ููุจุน:", sourceSelection);

        alert(
          `ุงุฑุฌุงุน ุซุจุช ุดุฏ โ\nููุตุฏ: ${targetSelection}\nููุจุน: ${sourceSelection}`
        );

        // ูพุงฺฉโุณุงุฒ
        targetSelection = "";
        sourceSelection = "";
        saveBtn.disabled = true;
      });
    </script>
  </body>
</html>
